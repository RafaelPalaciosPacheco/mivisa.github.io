<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Probabilidad de Visa (Diseño Profesional)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
        }
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 8px;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 240px;
            background-color: #1f2937; /* bg-gray-800 */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            font-weight: 400;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .custom-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 3rem; 
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Custom Alert Modal -->
    <div id="customAlert" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm w-full">
            <p id="customAlertMessage" class="text-lg mb-6 text-gray-700"></p>
            <button id="closeAlert" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-8 rounded-lg transition-colors">Cerrar</button>
        </div>
    </div>

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <div class="bg-white rounded-2xl shadow-2xl border border-slate-200 p-6 md:p-10">
            <header class="text-center mb-10">
                <h1 class="text-3xl md:text-4xl font-bold text-blue-900">🇺🇸 Calculadora de Probabilidad de Visa</h1>
                <p class="text-slate-500 mt-3">Basada en consejos de ex-cónsules. Responde con total honestidad.</p>
            </header>

            <form id="visaForm" class="space-y-8">
                <!-- Fila de Preguntas 1 -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label for="purpose" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Motivo principal del viaje</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Debe ser un motivo temporal y creíble. El turismo y los negocios son los más sólidos para demostrar que no tienes intención de inmigrar.</span>
                            </div>
                        </label>
                        <select id="purpose" name="purpose" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="tourism">Turismo / Compras</option>
                            <option value="business">Negocios / Conferencia</option>
                            <option value="family">Visitar Familiares (con estatus legal)</option>
                            <option value="studies">Estudios / Intercambio</option>
                        </select>
                    </div>
                    <div>
                        <label for="travelPlan" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>¿Qué tan definido está tu plan?</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Un plan específico (fechas, lugares, hoteles) demuestra que eres un turista organizado, no alguien que improvisa. Es un factor muy positivo.</span>
                            </div>
                        </label>
                        <select id="travelPlan" name="travelPlan" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="defined">Tengo un itinerario claro</option>
                            <option value="vague">Solo una idea general</option>
                        </select>
                    </div>
                </div>

                <!-- Fila de Preguntas 2 -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label for="duration" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Duración de la estancia</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">La duración debe ser LÓGICA con tu ocupación. Si eres empleado, un viaje de más de 3-4 semanas es una bandera roja.</span>
                            </div>
                        </label>
                        <select id="duration" name="duration" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="short">Menos de 2 semanas</option>
                            <option value="medium">Entre 2 y 4 semanas</option>
                            <option value="long">Más de un mes</option>
                        </select>
                    </div>
                    <div>
                        <label for="companions" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>¿Con quién viajas?</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Viajar con tu familia (cónyuge, hijos) es un lazo muy fuerte. Viajar solo no es malo si tu perfil es sólido.</span>
                            </div>
                        </label>
                        <select id="companions" name="companions" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="family">Con mi cónyuge y/o hijos</option>
                            <option value="alone">Solo/a</option>
                            <option value="friends_other_family">Con amigos / otros familiares</option>
                        </select>
                    </div>
                </div>

                <!-- Fila de Preguntas 3 -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label for="occupation" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Ocupación actual</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Tu ocupación es tu principal lazo profesional. Un trabajo o negocio estable es una de las pruebas más fuertes de que regresarás a tu país.</span>
                            </div>
                        </label>
                        <select id="occupation" name="occupation" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="employed">Empleado</option>
                            <option value="student">Estudiante</option>
                            <option value="business_owner">Dueño de Negocio</option>
                            <option value="unemployed">Desempleado / Labores del hogar</option>
                            <option value="retired">Jubilado / Pensionado</option>
                        </select>
                    </div>
                    <div id="timeInJobContainer" class="hidden">
                         <label for="timeInJob" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Antigüedad en trabajo/escuela</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">La antigüedad demuestra estabilidad. Más de un año es positivo. Varios años en el mismo lugar es una señal excelente.</span>
                            </div>
                        </label>
                        <select id="timeInJob" name="timeInJob" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="less_1y">Menos de 1 año</option>
                            <option value="1y_3y">1 a 3 años</option>
                            <option value="3y_5y">3 a 5 años</option>
                            <option value="more_5y">Más de 5 años</option>
                        </select>
                    </div>
                </div>
                
                <!-- Fila de Preguntas 4 -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label for="whoPays" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>¿Quién paga el viaje?</span>
                             <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Demuestra solvencia económica. Si tú mismo pagas, es ideal. Si alguien más paga, debe tener una relación directa y lógica contigo (padres, cónyuge, empresa).</span>
                            </div>
                        </label>
                        <select id="whoPays" name="whoPays" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="myself">Yo mismo con mis ingresos</option>
                            <option value="parents_spouse">Mis padres / Mi cónyuge</option>
                            <option value="company">Mi empresa (viaje de negocios)</option>
                            <option value="other">Otra persona (amigo, familiar no directo)</option>
                        </select>
                    </div>
                     <div>
                        <label for="properties" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Propiedades a tu nombre</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Las propiedades son uno de los lazos económicos más fuertes. Demuestran arraigo e inversión en tu país. Es un factor muy positivo.</span>
                            </div>
                        </label>
                        <select id="properties" name="properties" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="yes">Sí, una o más</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                </div>

                <!-- Fila de Preguntas 5 -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label for="dependents" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Dependientes económicos</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Tener dependientes (hijos, padres, cónyuge) es un lazo familiar y de responsabilidad muy fuerte que te ancla a tu país.</span>
                            </div>
                        </label>
                        <select id="dependents" name="dependents" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="yes_spouse_kids">Sí, mi cónyuge y/o hijos</option>
                            <option value="yes_parents">Sí, mis padres u otros familiares</option>
                            <option value="no">No, nadie depende de mí</option>
                        </select>
                    </div>
                    <div>
                        <label for="relatives" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Familiares directos en EE.UU.</span>
                            <div class="tooltip">
                               <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Sé 100% honesto. Tener familiares ilegales es una bandera roja muy grande. Familiares legales pueden ser positivos si tu perfil es sólido.</span>
                            </div>
                        </label>
                        <select id="relatives" name="relatives" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="no">No</option>
                            <option value="yes_legal">Sí, con estatus legal</option>
                            <option value="yes_illegal">Sí, sin estatus migratorio</option>
                        </select>
                    </div>
                </div>

                <!-- Fila de Preguntas 6 -->
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                         <label for="travelHistoryUS" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Viajes previos a EE.UU.</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">Haber ido y regresado correctamente es una de las mejores pruebas. Si te quedaste más tiempo del permitido, es una bandera roja muy seria.</span>
                            </div>
                        </label>
                        <select id="travelHistoryUS" name="travelHistoryUS" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="no">No, nunca</option>
                            <option value="yes_good">Sí, y regresé a tiempo</option>
                            <option value="yes_bad">Sí, me quedé más tiempo</option>
                        </select>
                    </div>
                    <div>
                         <label for="travelHistoryOther" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                            <span>Viajes a otros países</span>
                            <div class="tooltip">
                                <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="tooltiptext">El historial de viajes internacionales demuestra que eres un turista genuino. Viajar a países de primer mundo (Europa, Asia) suma más puntos.</span>
                            </div>
                        </label>
                        <select id="travelHistoryOther" name="travelHistoryOther" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                            <option value="" disabled selected>Elige una respuesta</option>
                            <option value="none">No, nunca</option>
                            <option value="latam">Sí, a Latinoamérica</option>
                            <option value="world">Sí, a Europa, Asia, etc.</option>
                        </select>
                    </div>
                </div>

                <!-- Fila de Preguntas 7 -->
                <div>
                     <label for="socialMedia" class="block text-base font-semibold mb-2 flex items-center text-slate-700">
                        <span>Consistencia en redes sociales</span>
                        <div class="tooltip">
                            <svg class="w-5 h-5 text-slate-400 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span class="tooltiptext">Los cónsules PUEDEN revisar tus redes. Publicaciones sobre 'buscar trabajo en EE.UU.', memes de 'me voy y no vuelvo' o un estilo de vida que no concuerda con tus ingresos son banderas rojas.</span>
                        </div>
                    </label>
                    <select id="socialMedia" name="socialMedia" class="custom-select w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required>
                        <option value="" disabled selected>Elige una respuesta</option>
                        <option value="yes">Sí, son consistentes y privadas/limpias</option>
                        <option value="no">No, podrían tener publicaciones conflictivas</option>
                        <option value="none">No uso redes sociales / Son irrelevantes</option>
                    </select>
                </div>

                <!-- Botón de Calcular -->
                <div class="pt-6 text-center">
                    <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-12 rounded-lg text-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">
                        Calcular Probabilidad
                    </button>
                </div>
            </form>

            <!-- Sección de Resultados -->
            <div id="results" class="hidden mt-12">
                 <div class="bg-blue-50 border-t-4 border-blue-500 text-blue-900 p-4 mb-10 rounded-b-lg shadow-md" role="alert">
                    <p class="font-bold">Advertencia Importante</p>
                    <p class="text-sm">Esta herramienta es una guía educativa. La decisión final depende 100% del oficial consular. Tu formulario DS-160 es la parte más importante de tu solicitud; toda tu información debe ser verídica y consistente.</p>
                </div>

                <h2 class="text-3xl font-bold text-center text-slate-900 mb-8">Análisis de tu Perfil Consular</h2>
                
                <div class="mb-10">
                    <div class="flex justify-between mb-1">
                        <span class="text-base font-medium text-blue-700">Probabilidad de Aprobación</span>
                        <span id="probabilityText" class="text-sm font-medium text-blue-700"></span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-5">
                        <div id="progressBar" class="bg-gradient-to-r from-red-500 to-blue-600 h-5 rounded-full text-center text-white font-bold flex items-center justify-center transition-all duration-1000 ease-out text-sm" style="width: 0%"></div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white border-l-4 border-green-500 p-6 rounded-r-lg shadow-sm">
                        <h3 class="text-xl font-semibold text-green-800 mb-4">✅ Tus Lazos Fuertes</h3>
                        <ul id="strongPoints" class="list-disc list-inside space-y-2 text-slate-600 text-sm"></ul>
                    </div>
                    <div class="bg-white border-l-4 border-red-600 p-6 rounded-r-lg shadow-sm">
                        <h3 class="text-xl font-semibold text-red-800 mb-4">⚠️ Posibles Banderas Rojas</h3>
                        <ul id="weakPoints" class="list-disc list-inside space-y-2 text-slate-600 text-sm"></ul>
                    </div>
                </div>

                <div class="mt-10 bg-white border-t-4 border-blue-600 p-6 rounded-b-lg shadow-sm">
                    <h3 class="text-xl font-semibold text-blue-800 mb-4">💡 Consejo del Cónsul: ¿Cómo responder?</h3>
                    <div id="interviewTips" class="text-slate-600 leading-relaxed text-sm"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Lógica de la Aplicación ---

        const form = document.getElementById('visaForm');
        const occupationSelect = document.getElementById('occupation');
        const timeInJobContainer = document.getElementById('timeInJobContainer');
        const timeInJobSelect = document.getElementById('timeInJob');
        const resultsSection = document.getElementById('results');
        const progressBar = document.getElementById('progressBar');
        const probabilityText = document.getElementById('probabilityText');
        const strongPointsList = document.getElementById('strongPoints');
        const weakPointsList = document.getElementById('weakPoints');
        const interviewTipsParagraph = document.getElementById('interviewTips');
        
        const customAlert = document.getElementById('customAlert');
        const customAlertMessage = document.getElementById('customAlertMessage');
        const closeAlertButton = document.getElementById('closeAlert');

        function showCustomAlert(message) {
            customAlertMessage.textContent = message;
            customAlert.classList.remove('hidden');
        }

        closeAlertButton.addEventListener('click', () => {
            customAlert.classList.add('hidden');
        });

        function toggleTimeInJobField() {
            const selectedOccupation = occupationSelect.value;
            if (selectedOccupation && selectedOccupation !== 'unemployed' && selectedOccupation !== 'retired') {
                timeInJobContainer.style.display = 'block';
                timeInJobSelect.required = true;
            } else {
                timeInJobContainer.style.display = 'none';
                timeInJobSelect.required = false;
                timeInJobSelect.value = '';
            }
        }
        
        toggleTimeInJobField();
        occupationSelect.addEventListener('change', toggleTimeInJobField);

        const scores = {
            purpose: { tourism: 10, business: 10, family: 6, studies: 8 },
            travelPlan: { defined: 10, vague: 2 },
            duration: { short: 10, medium: 7, long: 2 },
            companions: { family: 10, alone: 6, friends_other_family: 7 },
            occupation: { employed: 10, student: 8, business_owner: 10, unemployed: 0, retired: 5 },
            timeInJob: { less_1y: 2, '1y_3y': 7, '3y_5y': 9, more_5y: 10 },
            whoPays: { myself: 10, parents_spouse: 8, company: 10, other: 2 },
            properties: { yes: 10, no: 2 },
            dependents: { yes_spouse_kids: 10, yes_parents: 7, no: 3 },
            relatives: { no: 10, yes_legal: 5, yes_illegal: 0 },
            travelHistoryUS: { no: 4, yes_good: 10, yes_bad: 0 },
            travelHistoryOther: { none: 2, latam: 6, world: 10 },
            socialMedia: { yes: 10, no: 0, none: 8 }
        };

        const feedback = {
            strong: {
                purpose: "Tu motivo de viaje es claro y temporal, lo cual es excelente.",
                travelPlan: "Tener un plan de viaje definido es una señal muy fuerte de que eres un turista organizado y genuino.",
                duration: "La duración de tu viaje es coherente con un perfil de turista.",
                companions: "Viajar con tu familia nuclear es un lazo de arraigo muy fuerte.",
                occupation: "Tu ocupación estable es un lazo profesional muy fuerte que te ata a tu país.",
                timeInJob: "Tu antigüedad laboral demuestra estabilidad y compromiso.",
                whoPays: "Poder costear tu propio viaje demuestra una sólida solvencia económica.",
                properties: "Tener propiedades es un lazo económico fundamental y una de las pruebas más fuertes de arraigo.",
                dependents: "Tener dependientes económicos es un lazo familiar y de responsabilidad muy poderoso.",
                travelHistoryUS: "Haber viajado a EE.UU. y regresado correctamente es la mejor prueba de que respetas las leyes de inmigración.",
                travelHistoryOther: "Tu historial de viajes internacionales demuestra que eres un viajero genuino que siempre regresa.",
                socialMedia: "Tener redes sociales consistentes (o no tenerlas) evita contradicciones y es positivo."
            },
            weak: {
                travelPlan: "Un plan de viaje vago puede generar sospechas. Es crucial que puedas explicar claramente qué quieres hacer y por cuánto tiempo.",
                duration: "Una estancia larga puede ser una bandera roja si no es consistente con tus permisos laborales (vacaciones).",
                companions: "Viajar solo no es necesariamente malo, pero requiere que tus otros lazos sean muy sólidos.",
                occupation: "La falta de un empleo formal es una bandera roja. Debes compensar con otros lazos muy fuertes.",
                timeInJob: "Poca antigüedad laboral puede generar dudas sobre tu estabilidad.",
                whoPays: "Si un tercero no directo paga tu viaje, puede generar dudas. Asegúrate de explicar bien la relación y el motivo.",
                properties: "No tener propiedades debilita tus lazos económicos. Deberás enfatizar mucho tus lazos profesionales y familiares.",
                dependents: "No tener dependientes puede interpretarse como que tienes menos ataduras. Es crucial resaltar otras responsabilidades.",
                relatives: "Tener familiares en EE.UU. (especialmente sin estatus) es una bandera roja crítica. La honestidad es tu única opción.",
                travelHistoryUS: "Haberte quedado más tiempo del permitido es una falta muy grave y una bandera roja casi insuperable.",
                travelHistoryOther: "La falta de historial de viajes es un punto débil. El cónsul no tiene pruebas previas de tu comportamiento como turista.",
                socialMedia: "Redes sociales con contenido conflictivo (bromas de 'me voy a trabajar', etc.) pueden ser causa de negación."
            }
        };

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            if (!form.checkValidity()) {
                showCustomAlert("Por favor, responde todas las preguntas para poder calcular tu resultado.");
                return;
            }

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            let totalScore = 0;
            let maxScore = 0;
            const strongPoints = [];
            const weakPoints = [];
            const suggestions = [];

            const addResult = (category, value) => {
                if (!scores[category] || value === null || value === undefined) {
                    maxScore += 10; // No penalizar si la pregunta no aplica (ej. antigüedad)
                    return 'neutral';
                }
                const score = scores[category][value];
                totalScore += score;
                maxScore += 10;
                if (score >= 7) { 
                    strongPoints.push(feedback.strong[category]); 
                    return 'strong';
                } else if (score <= 3) {
                    weakPoints.push(feedback.weak[category]);
                    return 'weak';
                }
                return 'neutral';
            };

            addResult('purpose', data.purpose);
            if(addResult('travelPlan', data.travelPlan) === 'strong') { suggestions.push("Describe tu itinerario con claridad (a dónde vas, por cuánto tiempo y qué harás)."); }
            addResult('duration', data.duration);
            if(addResult('companions', data.companions) === 'strong') { suggestions.push("Menciona que viajas con tu familia como prueba de lazos."); }
            
            const occupationStatus = addResult('occupation', data.occupation);
            if(occupationStatus === 'strong') { suggestions.push(`Habla de tu trabajo o negocio como tu principal ancla profesional.`); }
            
            if (data.occupation !== 'unemployed' && data.occupation !== 'retired') {
                if(addResult('timeInJob', data.timeInJob) === 'strong') { suggestions.push(`Menciona tu antigüedad como prueba de estabilidad.`); }
            }
            
            if(addResult('whoPays', data.whoPays) === 'strong') { suggestions.push("Deja claro que tienes los fondos suficientes para tu viaje."); }
            if(addResult('properties', data.properties) === 'strong') { suggestions.push("Menciona tus propiedades como prueba de tu patrimonio en tu país."); }
            if(addResult('dependents', data.dependents) === 'strong') { suggestions.push("Habla de tu familia y responsabilidades como tu principal razón para volver."); }
            
            addResult('relatives', data.relatives);
            
            if(addResult('travelHistoryUS', data.travelHistoryUS) === 'strong') { suggestions.push("Menciona tu buen historial de viajes a EE.UU."); }
            addResult('travelHistoryOther', data.travelHistoryOther);
            addResult('socialMedia', data.socialMedia);
            
            const probability = Math.min(98, Math.round((totalScore / maxScore) * 100));

            updateUI(probability, strongPoints, weakPoints, suggestions);
        });

        function updateUI(probability, strong, weak, suggestions) {
            progressBar.style.width = `${probability}%`;
            progressBar.textContent = `${probability}%`;
            probabilityText.textContent = `${probability}%`;

            strongPointsList.innerHTML = strong.length > 0 ? strong.map(p => `<li>${p}</li>`).join('') : '<li>No se identificaron lazos fuertes claros. Es crucial que prepares tu caso para demostrar tu arraigo.</li>';
            weakPointsList.innerHTML = weak.length > 0 ? weak.map(p => `<li>${p}</li>`).join('') : '<li>¡Felicidades! Tu perfil parece muy sólido y no presenta banderas Rojas evidentes.</li>';
            
            let tipHTML;
            if (suggestions.length > 0) {
                tipHTML = `<p>El cónsul busca la verdad, la congruencia y un plan claro. Tu objetivo es demostrar que no tienes intención de quedarte. En la entrevista, responde de forma natural y directa. Basado en tu perfil, aquí tienes los puntos clave que debes enfatizar:</p>`;
                tipHTML += '<ul class="list-disc list-inside mt-4 space-y-2">';
                suggestions.forEach(suggestion => {
                    tipHTML += `<li>${suggestion}</li>`;
                });
                tipHTML += '</ul>';
                tipHTML += `<p class="mt-4">Recuerda: no des respuestas memorizadas. Sé breve, sé honesto y mira siempre al cónsul a los ojos. ¡Mucha suerte!</p>`;
            } else {
                 tipHTML = `<p>Tu perfil presenta varias banderas Rojas. Tu principal desafío será convencer al cónsul de que tienes razones poderosas para regresar. Prepárate para explicar tu situación con total honestidad. Reúne todos los documentos que puedas (escrituras, estados de cuenta, cartas de trabajo, actas de nacimiento de hijos) para respaldar tus palabras. La clave es ser creíble y que tu historia sea coherente.</p>`;
            }
            interviewTipsParagraph.innerHTML = tipHTML;

            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    </script>
</body>
</html>
